<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../css/fonts.css">

    <script src="../../bower_components/webcomponentsjs/webcomponents.js"></script>
    <script>
      window.Polymer = {
        dom: 'shadow',
        lazyRegister: true,
        useNativeCSSProperties: true
      };
    </script>
    <link rel="import" href="./import.html">

    <title>Markdown Manager</title>
    <script>
      window.Elm = require('../../dist/elmapp.js');
    </script>
  </head>
  <body>
    <div id='app'></div>
    <script>
      var api = require('./api');
      var config = api.getConfig();
      var authors = api.getAuthors();
      var nextIds = api.getNextIds();
      var defaultAuthor = api.getDefaultAuthor();
      var posts = api.getPosts();

      var node = document.getElementById('app');
      var app = Elm.Main.embed(node, {
        config: config,
        authors: authors,
        nextIds: nextIds,
        defaultAuthor: defaultAuthor,
        posts: posts
      });

      app.ports.saveConfig.subscribe(function(cfg) {
        api.saveConfig(cfg);
      });

      app.ports.saveAuthors.subscribe(function(authors) {
        api.saveAuthors(authors);
      });

      app.ports.delAuthor.subscribe(function(id) {
        api.delAuthor(id);
      });

      app.ports.saveNextIds.subscribe(function(nextIds) {
        api.saveNextIds(nextIds);
      });

      app.ports.saveDefaultAuthor.subscribe(function(defaultAuthor) {
        api.saveDefaultAuthor(defaultAuthor);
      });

      app.ports.savePost.subscribe(function(post) {
        api.savePost(post);
      });

      app.ports.delPost.subscribe(function(id) {
        api.delPost(id);
      });
    </script>
  </body>
</html>
